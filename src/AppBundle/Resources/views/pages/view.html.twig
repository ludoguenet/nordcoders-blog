{% extends"@App/layout.html.twig" %}
{% block title %} {{ parent() }} {{ post.title }} {% endblock %}
{% block body %}
    <div class="blog-post">
        <h1>{{ post.title }}</h1>
        <em>Ecrit par <strong>{{ post.author }}</strong>, le {{ post.createdAt|date('d/m/Y') }}</em>
        {% if(post.image != null) %}
            <img src="{{ asset('uploads/img/') ~ post.image.id ~ '.' ~ post.image.extension }}"
                 alt="{{ post.image.alt }}">
        {% endif %}
        <p>{{ post.content|raw }}</p>
        <p>
            {% for tag in post.tags %}
                <strong><span class="tag"><ion-icon name="folder"></ion-icon> {{ tag.name }}</span></strong>
            {% endfor %}
        </p>
    </div>
    <div class="comments">
        {% if is_granted('IS_AUTHENTICATED_REMEMBERED') %}
            {{ form_start(form) }}
            {{ form_row(form.content) }}
            {{ form_end(form) }}
        {% else %}
            <p><a href="{{ path('login') }}">Connectez-vous</a> pour commenter !</p>
        {% endif %}
    </div>
    <br>
    <h2><ion-icon name="chatbubbles"></ion-icon> Commentaires:</h2>
    {% if comments|length > 0 %}
    {% for comment in comments %}
        <div class="comment">
            <em>{{ comment.user.username }} a dit</em>
            <p>{{ comment.content }}</p>
        </div>
        {% if (is_granted('delete', comment)) %}
            <form action="{{ path('comment.delete', {'id': comment.id}) }}" method="post">
                <input type="hidden" name="token" value="{{ csrf_token('comment-item') }}">
                <button class="btn btn-danger" type="submit">Supprimer ce commentaire</button>
            </form>
        {% endif %}
    {% endfor %}
    {% else %}
        <h4>Aucun commentaire sur cet article pour le moment</h4>
    {% endif %}
{% endblock %}